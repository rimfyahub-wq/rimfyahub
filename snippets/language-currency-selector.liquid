{% comment %}
  Language and Currency Selector
  Usage: {% render 'language-currency-selector', location: 'header' %}
{% endcomment %}

<div class="locale-selector locale-selector--header" style="display: flex !important; align-items: center; gap: 0.5rem; margin-right: 1rem; visibility: visible !important;">
  
  {% comment %} Language Selector {% endcomment %}
  {% if localization.available_languages.size > 1 %}
    <div class="locale-selector__item" style="position: relative;">
      {% form 'localization', class: 'locale-form', id: 'localization_form_language' %}
        <button type="button" class="locale-button" onclick="toggleLocaleDropdown('language')" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer; transition: all 0.2s ease; font-size: 0.875rem;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="2" y1="12" x2="22" y2="12"></line>
            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
          </svg>
          <span class="locale-text">{{ localization.language.endonym_name }}</span>
          <svg class="locale-icon" width="12" height="12" viewBox="0 0 12 12" fill="none" style="transition: transform 0.2s ease;">
            <path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
        
        <div class="locale-dropdown" id="language-dropdown" style="display: none; position: absolute; top: calc(100% + 0.5rem); right: 0; min-width: 200px; background: rgba(10, 10, 10, 0.98); border: 1px solid rgba(0, 229, 255, 0.3); border-radius: 12px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5); backdrop-filter: blur(20px); padding: 0.5rem; z-index: 1000; max-height: 400px; overflow-y: auto;">
          {% for language in localization.available_languages %}
            <button 
              type="submit" 
              name="language_code" 
              value="{{ language.iso_code }}"
              style="display: flex; align-items: center; gap: 0.75rem; width: 100%; padding: 0.75rem; background: {% if language.iso_code == localization.language.iso_code %}rgba(0, 229, 255, 0.15){% else %}transparent{% endif %}; border: none; border-radius: 8px; color: {% if language.iso_code == localization.language.iso_code %}hsl(193, 100%, 65%){% else %}rgba(255, 255, 255, 0.8){% endif %}; cursor: pointer; transition: all 0.2s ease; text-align: left; font-size: 0.875rem;"
              onmouseover="this.style.background='rgba(0, 229, 255, 0.1)'; this.style.color='hsl(193, 100%, 65%)'"
              onmouseout="this.style.background='{% if language.iso_code == localization.language.iso_code %}rgba(0, 229, 255, 0.15){% else %}transparent{% endif %}'; this.style.color='{% if language.iso_code == localization.language.iso_code %}hsl(193, 100%, 65%){% else %}rgba(255, 255, 255, 0.8){% endif %}'"
            >
              <span>{{ language.endonym_name }}</span>
              {% if language.iso_code == localization.language.iso_code %}
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="margin-left: auto;">
                  <path d="M13 4L6 11L3 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              {% endif %}
            </button>
          {% endfor %}
        </div>
      {% endform %}
    </div>
  {% else %}
    {% comment %} Debug: Show how many languages available {% endcomment %}
    <div style="padding: 0.5rem 0.75rem; background: rgba(255, 200, 0, 0.2); border: 1px solid rgba(255, 200, 0, 0.5); border-radius: 8px; color: #ffc800; font-size: 0.75rem; white-space: nowrap;">
      üåê {{ localization.available_languages.size }} lang
    </div>
  {% endif %}
</div>

<script>
  function toggleLocaleDropdown(type) {
    const dropdown = document.getElementById(type + '-dropdown');
    if (!dropdown) return;
    
    const button = dropdown.previousElementSibling;
    const isOpen = dropdown.style.display === 'block';
    
    // Close all dropdowns
    document.querySelectorAll('.locale-dropdown').forEach(dd => {
      dd.style.display = 'none';
    });
    
    // Toggle current dropdown
    if (!isOpen) {
      dropdown.style.display = 'block';
      if (button) button.setAttribute('aria-expanded', 'true');
    } else {
      if (button) button.setAttribute('aria-expanded', 'false');
    }
  }

  // Close dropdowns when clicking outside
  document.addEventListener('click', function(event) {
    if (!event.target.closest('.locale-selector__item')) {
      document.querySelectorAll('.locale-dropdown').forEach(dropdown => {
        dropdown.style.display = 'none';
      });
    }
  });
</script>
