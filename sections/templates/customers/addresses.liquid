{% comment %}
  Customer Addresses Page
{% endcomment %}

<div class="addresses-page">
  <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 6rem 2rem 4rem;">
    <div class="page-header" style="margin-bottom: 3rem;">
      <h1 style="font-size: 2.5rem; font-weight: 700; background: linear-gradient(135deg, hsl(193, 100%, 65%), hsl(280, 100%, 70%)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.5rem;">
        My Addresses
      </h1>
      <a href="{{ routes.account_url }}" style="color: hsl(193, 100%, 65%); text-decoration: none;">
        ← Back to Account
      </a>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem;">
      {% paginate customer.addresses by 20 %}
        {% for address in customer.addresses %}
          <div style="background: rgba(10,10,10,0.8); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 1.5rem;">
            {% if address == customer.default_address %}
              <span style="display: inline-block; padding: 0.25rem 0.75rem; background: rgba(0,229,255,0.2); border-radius: 20px; font-size: 0.75rem; color: hsl(193, 100%, 65%); margin-bottom: 1rem;">
                Default
              </span>
            {% endif %}
            
            <div style="color: rgba(255,255,255,0.8); margin-bottom: 1.5rem;">
              <p style="font-weight: 600; color: white; margin-bottom: 0.5rem;">{{ address.first_name }} {{ address.last_name }}</p>
              <p>{{ address.address1 }}</p>
              {% if address.address2 != blank %}
                <p>{{ address.address2 }}</p>
              {% endif %}
              <p>{{ address.city }}, {{ address.province_code }} {{ address.zip }}</p>
              <p>{{ address.country }}</p>
              {% if address.phone != blank %}
                <p>{{ address.phone }}</p>
              {% endif %}
            </div>

            <div style="display: flex; gap: 0.5rem;">
              <button onclick="openEditAddress({{ address.id }})" style="flex: 1; padding: 0.5rem; background: rgba(0,229,255,0.1); border: 1px solid rgba(0,229,255,0.3); border-radius: 6px; color: hsl(193, 100%, 65%); cursor: pointer; font-size: 0.875rem;">
                Edit
              </button>
              <button onclick="deleteAddress('{{ routes.account_addresses_url }}/{{ address.id }}')" style="flex: 1; padding: 0.5rem; background: rgba(255,68,68,0.1); border: 1px solid rgba(255,68,68,0.3); border-radius: 6px; color: #ff4444; cursor: pointer; font-size: 0.875rem;">
                Delete
              </button>
            </div>
          </div>
        {% endfor %}
      {% endpaginate %}

      <!-- Add New Address Card -->
      <div onclick="openAddAddress()" style="background: rgba(10,10,10,0.5); border: 2px dashed rgba(255,255,255,0.2); border-radius: 12px; padding: 1.5rem; display: flex; align-items: center; justify-content: center; min-height: 250px; cursor: pointer; transition: all 0.2s;">
        <div style="text-align: center;">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="rgba(0,229,255,0.5)" stroke-width="2" style="margin: 0 auto 1rem;">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="16"></line>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
          <p style="color: hsl(193, 100%, 65%); font-weight: 600;">Add New Address</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Address Modal -->
<div id="address-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 9999; align-items: center; justify-content: center;">
  <div style="background: rgba(10,10,10,0.98); border: 1px solid rgba(0,229,255,0.3); border-radius: 16px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; padding: 2rem; position: relative;">
    <button onclick="closeAddressModal()" style="position: absolute; top: 1rem; right: 1rem; background: transparent; border: none; color: rgba(255,255,255,0.6); font-size: 1.5rem; cursor: pointer; padding: 0.5rem; line-height: 1;">
      ×
    </button>

    <h2 id="modal-title" style="font-size: 1.5rem; font-weight: 700; background: linear-gradient(135deg, hsl(193, 100%, 65%), hsl(280, 100%, 70%)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 1.5rem;">
      Add New Address
    </h2>

    <div id="add-address-form">
      {% form 'customer_address', customer.new_address %}
        <div style="display: grid; gap: 1rem;">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div>
              <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">First Name *</label>
              <input type="text" name="address[first_name]" required style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
            </div>
            <div>
              <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Last Name *</label>
              <input type="text" name="address[last_name]" required style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
            </div>
          </div>

          <div>
            <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Company</label>
            <input type="text" name="address[company]" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
          </div>

          <div>
            <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Address 1 *</label>
            <input type="text" name="address[address1]" required style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
          </div>

          <div>
            <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Address 2</label>
            <input type="text" name="address[address2]" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
          </div>

          <div>
            <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">City *</label>
            <input type="text" name="address[city]" required style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div>
              <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Country *</label>
              <select name="address[country]" data-default="{{ customer.new_address.country }}" required style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                {{ country_option_tags }}
              </select>
            </div>
            <div>
              <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Province/State</label>
              <input type="text" name="address[province]" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div>
              <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">ZIP/Postal Code *</label>
              <input type="text" name="address[zip]" required style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
            </div>
            <div>
              <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Phone</label>
              <input type="tel" name="address[phone]" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
            </div>
          </div>

          <div>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" name="address[default]" style="width: 18px; height: 18px; cursor: pointer;">
              <span style="color: rgba(255,255,255,0.8); font-size: 0.875rem;">Set as default address</span>
            </label>
          </div>

          <button type="submit" style="width: 100%; padding: 0.875rem; background: linear-gradient(135deg, hsl(193, 100%, 50%), hsl(280, 100%, 60%)); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; margin-top: 0.5rem;">
            Save Address
          </button>
        </div>
      {% endform %}
    </div>

    <!-- Edit forms (hidden by default) -->
    {% for address in customer.addresses %}
      <div id="edit-address-{{ address.id }}" style="display: none;">
        {% form 'customer_address', address %}
          <div style="display: grid; gap: 1rem;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">First Name *</label>
                <input type="text" name="address[first_name]" value="{{ address.first_name }}" required style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Last Name *</label>
                <input type="text" name="address[last_name]" value="{{ address.last_name }}" required style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
              </div>
            </div>

            <div>
              <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Company</label>
              <input type="text" name="address[company]" value="{{ address.company }}" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
            </div>

            <div>
              <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Address 1 *</label>
              <input type="text" name="address[address1]" value="{{ address.address1 }}" required style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
            </div>

            <div>
              <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Address 2</label>
              <input type="text" name="address[address2]" value="{{ address.address2 }}" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
            </div>

            <div>
              <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">City *</label>
              <input type="text" name="address[city]" value="{{ address.city }}" required style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Country *</label>
                <select name="address[country]" data-default="{{ address.country }}" required style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                  {{ country_option_tags }}
                </select>
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Province/State</label>
                <input type="text" name="address[province]" value="{{ address.province }}" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
              </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">ZIP/Postal Code *</label>
                <input type="text" name="address[zip]" value="{{ address.zip }}" required style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.875rem;">Phone</label>
                <input type="tel" name="address[phone]" value="{{ address.phone }}" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
              </div>
            </div>

            <div>
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" name="address[default]" {% if address == customer.default_address %}checked{% endif %} style="width: 18px; height: 18px; cursor: pointer;">
                <span style="color: rgba(255,255,255,0.8); font-size: 0.875rem;">Set as default address</span>
              </label>
            </div>

            <button type="submit" style="width: 100%; padding: 0.875rem; background: linear-gradient(135deg, hsl(193, 100%, 50%), hsl(280, 100%, 60%)); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; margin-top: 0.5rem;">
              Update Address
            </button>
          </div>
        {% endform %}
      </div>
    {% endfor %}
  </div>
</div>

<script>
  function openAddAddress() {
    const modal = document.getElementById('address-modal');
    const title = document.getElementById('modal-title');
    const addForm = document.getElementById('add-address-form');
    
    title.textContent = 'Add New Address';
    addForm.style.display = 'block';
    
    // Hide all edit forms
    {% for address in customer.addresses %}
      document.getElementById('edit-address-{{ address.id }}').style.display = 'none';
    {% endfor %}
    
    modal.style.display = 'flex';
  }

  function openEditAddress(addressId) {
    const modal = document.getElementById('address-modal');
    const title = document.getElementById('modal-title');
    const addForm = document.getElementById('add-address-form');
    
    title.textContent = 'Edit Address';
    addForm.style.display = 'none';
    
    // Hide all edit forms first
    {% for address in customer.addresses %}
      document.getElementById('edit-address-{{ address.id }}').style.display = 'none';
    {% endfor %}
    
    // Show the specific edit form
    document.getElementById('edit-address-' + addressId).style.display = 'block';
    modal.style.display = 'flex';
  }

  function closeAddressModal() {
    document.getElementById('address-modal').style.display = 'none';
  }

  function deleteAddress(deleteUrl) {
    if (confirm('Are you sure you want to delete this address?')) {
      // Create and submit a form to delete the address
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = deleteUrl;
      
      const methodInput = document.createElement('input');
      methodInput.type = 'hidden';
      methodInput.name = '_method';
      methodInput.value = 'delete';
      form.appendChild(methodInput);
      
      document.body.appendChild(form);
      form.submit();
    }
  }

  // Close modal when clicking outside
  document.getElementById('address-modal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeAddressModal();
    }
  });
</script>

<style>
  body {
    background: #000;
    color: white;
  }
  
  select option {
    background: #1a1a1a;
    color: white;
  }
  
  input:focus,
  select:focus {
    outline: none;
    border-color: hsl(193, 100%, 65%);
  }
</style>
